{"version":3,"sources":["src/dactylographsy.js"],"names":[],"mappings":"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","file":"src/dactylographsy.js","sourcesContent":["class Ajax {\n  constructor() {\n\n  }\n\n  get(url, options = {}) {\n    return new Promise((resolve, reject) => {\n      let xhr = new XMLHttpRequest();\n\n      if ('withCredentials' in xhr) {\n        // XHR for Chrome/Firefox/Opera/Safari.\n        xhr.open('GET', url, true);\n      } else if (typeof XDomainRequest !== 'undefined') {\n        // XDomainRequest for IE.\n        xhr = new XDomainRequest();\n        xhr.open('GET', url);\n      } else {\n        // CORS not supported.\n        xhr = null;\n      }\n\n      if (options.withCredentials) {\n        xhr.withCredentials = true;\n      }\n\n      if (options.customHeaders) {\n        options.customHeaders.forEach(header => {\n          xhr.setRequestHeader(header.name, header.value);\n        });\n      }\n\n      // Response handlers.\n      xhr.onload = function() {\n        resolve({\n          xhr: xhr,\n          text: xhr.responseText,\n          url: xhr.responseURL\n        });\n      };\n\n      xhr.onerror = function() {\n        reject(xhr);\n      };\n\n      xhr.send();\n    });\n  }\n}\n\nclass Cache {\n  constructor(options = {}) {\n    this.options = options;\n  }\n\n  get(key) {\n    return new Promise((resolve, reject) => {\n      let _item = JSON.parse(\n        localStorage.getItem(key)\n      );\n\n      if (_item) {\n        console.info(`Found item with key: ${key} in cache.`);\n\n        resolve(_item.code);\n      } else {\n        console.info(`Couldn\\'t find item with key: ${key} in cache.`);\n\n        reject();\n      }\n    });\n  }\n\n  has(key) {\n    return localStorage.getItem(key) !== null;\n  }\n\n  set(code, type, url) {\n    let cached = {\n      now: +new Date(),\n      url: url,\n      code: code,\n      type: type\n    };\n\n    localStorage.setItem(\n      url,\n      JSON.stringify(cached)\n    );\n  }\n}\n\nclass Js {\n  constructor(injectInto) {\n    this.injectInto = injectInto;\n    this.cache = new Cache();\n  }\n\n  injectWithText(text) {\n    return new Promise((resolve) => {\n      let script = document.createElement('script');\n\n      script.defer = true;\n\n      script.text = text;\n\n      if (this.injectInto) { this.injectInto.appendChild(script); }\n\n      resolve(script);\n    });\n  }\n\n  injectWithUrl(url) {\n    return new Promise(resolve => {\n      // Create script element and set its type\n      let script = document.createElement('script');\n\n      script.type = 'text/javascript';\n      script.async = false;\n\n      // Bind to readyState or register ´onload´ callback\n      if (script.readyState) {\n        // Callback for IE's `onreadystatechange` (I feel seesick)\n        script.onreadystatechange = () => {\n          if (script.readyState === 'loaded' || script.readyState === 'complete') {\n            script.onreadystatechange = null;\n\n            this.cache(url);\n          }\n        };\n      } else {\n        // Bind `onload` callback on script element\n        script.onload = () => {\n          this.ensureCache(url);\n        };\n      }\n\n      // Set the url\n      script.src = url;\n\n      if (this.injectInto) { this.injectInto.appendChild(script); }\n\n      resolve(script);\n    });\n  }\n\n  ensureCache(url) {\n    return new Promise(resolve => {\n      if (this.cache.has(url)) { resolve(); }\n\n      return new Ajax()\n        .get(url)\n        .then(response => {\n          let { text : responseText } = response;\n\n          this.cache.set(responseText, 'js', url);\n\n          resolve();\n        });\n    });\n  }\n\n  inject(url) {\n    return this.cache.get(url)\n      .then(text => {\n        return this.injectWithText(text);\n      })\n      .catch(() => {\n        return this.injectWithUrl(url);\n      });\n  }\n}\n\nclass Css {\n  constructor(injectInto) {\n    this.injectInto = injectInto;\n    this.cache = new Cache();\n  }\n\n  ensureCache(url) {\n    return new Promise(resolve => {\n      if (this.cache.has(url)) { resolve(); }\n\n      return new Ajax()\n        .get(url)\n        .then(response => {\n          let { text : responseText } = response;\n\n          this.cache.set(responseText, 'css', url);\n\n          resolve();\n        });\n    });\n  }\n\n  injectWithUrl(url) {\n    return new Promise(resolve => {\n      let link = document.createElement('link');\n\n      link = document.createElement('link');\n\n      link.type = 'text/css';\n      link.rel = 'stylesheet';\n\n      link.href = url;\n\n      if (this.injectInto) { this.injectInto.appendChild(link); }\n\n      this.ensureCache(url);\n\n      resolve(link);\n    });\n  }\n\n  injectWithText(text) {\n    return new Promise(resolve => {\n      let style = document.createElement('link');\n\n      style = document.createElement('style');\n\n      style.textContent = text;\n\n      if (this.injectInto) { this.injectInto.appendChild(style); }\n\n      resolve(style);\n    });\n  }\n\n  inject(url) {\n    return this.cache.get(url)\n      .then(text => {\n        return this.injectWithText(text);\n      })\n      .catch(() => {\n        return this.injectWithUrl(url);\n      });\n  }\n}\n\nclass Manifest {\n  constructor(url) {\n    this.url = url;\n    this.cache = new Cache();\n  }\n\n  get() {\n    return new Ajax()\n      .get(this.url)\n      .then(response => {\n        let {\n          text : responseText,\n          url : responseUrl\n        } = response;\n\n        console.info(`Fetched manifest from url: ${responseUrl}.`);\n\n        return JSON.parse(responseText);\n      }, xhr => {\n        console.error(`Could not fetch manifest with url: ${xhr.responseURL}!`);\n      });\n  }\n}\n\nclass Injector {\n  constructor(injectInto, manifests, options = {}) {\n    this.manifests = {};\n    this.injectInto = injectInto;\n\n    manifests.forEach(manifest => {\n      this.manifests[manifest.package] = manifest;\n    });\n\n    this.prefix = options.prefix || '';\n    this.order = options.order;\n  }\n\n  inject() {\n    this.order.map(_package => {\n      if (!this.manifests[_package]) {\n        console.error(`Couldn\\'t find package ${_package} from injection order.`);\n      } else {\n        this.injectManifest(this.manifests[_package]);\n      }\n    });\n  }\n\n  injectManifest(manifest) {\n    let\n      hashes = Object.keys(manifest.hashes);\n\n    return hashes.map(hash => {\n      let dependency = manifest.hashes[hash];\n\n      this.injectDependency(dependency, manifest.rootUrl || manifest.package);\n\n      return hash;\n    });\n  }\n\n  injectDependency(dependency, rootUrl) {\n    switch (dependency.extension) {\n      case '.css':\n        return new Css(\n          this.injectInto\n        ).inject(\n          this.url(dependency, rootUrl)\n        );\n      case '.js':\n        return new Js(\n          this.injectInto\n        ).inject(\n          this.url(dependency, rootUrl)\n        );\n    }\n  }\n\n  basename(path) {\n    return path.replace(/.*\\/|\\.[^.]*$/g, '');\n  }\n\n  url(dependency, rootUrl = '') {\n    let basename = this.basename(dependency.file);\n\n    return `${this.prefix}/${dependency.path}/${rootUrl}/${basename}-${dependency.hash}${dependency.extension}`;\n  }\n}\n\nclass Dactylographsy {\n  constructor(options) {\n    let { autorun = false } = options;\n\n    this.hookIntoDom();\n    this.readConfiguration();\n    this.cache = new Cache();\n\n    if (autorun) { this.run(); }\n  }\n\n  hookIntoDom() {\n    this.executingScript = document.getElementById('dactylographsy');\n    this.injectInto = document.body || document.head || document.getElementsByTagName('script')[0];\n  }\n\n  readConfiguration() {\n    this.manifestUrls = this.readAttrOnScript('manifests');\n    this.config = this.readAttrOnScript('config');\n  }\n\n  refresh(inject = true) {\n    return Promise.all(this.manifestUrls.map(url => {\n      return new Manifest(url).get();\n    })).then(manifests => {\n      console.info(`Fetched all manifests, ${manifests.length} in total.`);\n\n      this.cache.set(manifests, 'manifests', 'manifests');\n\n      return new Injector(inject ? this.injectInto : undefined, manifests, this.config).inject();\n    });\n  }\n\n  restore() {\n    return this.cache.get('manifests')\n      .then(manifests => {\n        console.info(`Resotring with manifests in cache later refreshing via network.`);\n\n        new Injector(this.injectInto, manifests, this.config).inject();\n\n        return false;\n      })\n      .catch(() => {\n        console.info(`No manifests in cache, refreshing via network.`);\n      });\n  }\n\n  readAttrOnScript(attr) {\n    let _attr = this.executingScript.getAttribute('data-' + attr);\n\n    return _attr ? JSON.parse(_attr) : undefined;\n  }\n\n  run() {\n    return this.restore()\n      .then(injectedFromCache => {\n        return this.refresh(injectedFromCache);\n      });\n  }\n}\n\nwindow.dactylographsy = new Dactylographsy({\n  autorun: true\n});\n"]}